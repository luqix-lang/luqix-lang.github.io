<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Luqix module-websocket</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">

    <link rel="stylesheet" type="text/css" href="../css/fancy.css">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <link rel="stylesheet" type="text/css" href="../css/docs.css">

    <link rel="stylesheet" type="text/css" href="../modules/flare/flare.css">
    
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style type="text/css">
        .code{
            background-color: #F4F4F5 !important;
            padding: 15px !important;
            border-radius: 10px !important;
        }

        .code, .code *{
            line-height: 19px !important;
        }
    </style>

</head>
<body>
    <p id="ID" class="d-none">Websocket module</p>
     <div class="mic sticky-top z-20 d-none-sm"> <nav class="flex sticky-top text-white relative z-20 justify-center align-items-center" id="nav"></nav> </div>
     <div id="nav-doc" class="sticky-top navd z-20 py-2 d-none-xxl d-block-sm"></div> 

     <div class="flex justify-center">
         <div class="flex col-8 col-9-lg  col-10-md z-10 relative">
             <div class="col-2-xxl col-3-md d-none-sm" data-aos="fade-right" id="sidebar"></div>
             <div class="col-8-xxl z-10 col-7-md col-10-sm bg-content">
                 <div class="page content px-10-xxl px-5-md  py-10">
                     <p class="md:text-4xl text-3xl font-bold">Module websocket</p>
                     <p class="mt-4">The websocket module is a builtin module that allows for the creation of a working TCP server that can be turned into a WebSocket connection. This allows for communication with the WebSocket protocol, which is often used for real-time communication between a client and server.</p>

                     <p class="mt-3">WebSocket by, as the client initiates a WebSocket connection by sending a handshake request to the server. Once the handshake is complete, the connection is kept open, allowing for bi-directional communication between the client and server. This means that either the client or server can send data at any time, without the need for the other party to first request it. WebSockets are ideal for real-time applications such as chat rooms, online games, and stock trading platforms, where data needs to be transmitted quickly and efficiently.</p>

                     <div role="alert" class="mt-10">
                        <div class="bg-indigo-500 text-white font-bold rounded-t px-4 py-2">Info</div>
                        <div class="border border-t-0 border-indigo-400 rounded-b bg-indigo-100 px-4 py-3 text-indigo-700">
                            <p class="text-indigo-700">For now, we can use this module to build browser apps backend by Luqix.</p>
                        </div>
                    </div>

                     <div class="line"></div>

                     <p class="mt-10 text-xl font-bold  flex align-items-center"><span class="blink">#</span><span class="type">obj</span> WebsocketServer<span class="fn">(<span class="args">string hostname, int port</span>)</span></p>
                     <div class="line mt-4"></div>
                     <p class="mt-3">This creates a websocket server object for sending and receiving data on the connection.</p>
                     <p class="ml-2 mt-1">* <a href="https://en.wikipedia.org/wiki/Hostname" class="key link">hostname</a> specifies the hostname address on which the server is listening.</p>
                     <p class="ml-2 mt-1">* <a href="https://en.wikipedia.org/wiki/Port_(computer_networking)" class="key link">port</a> specifies the a ushort number for the port on which the server is listening.</p>
                     <div class="my-6 code">app = WebsocketServer('localhost', 5500)</div>

                     <p class="mt-2">But the server does not start until you call its <a class="link key">start</a> function attribute and I recommend adding functions for the <a class="link key">onmessage</a> and <a class="link key">send</a>.</p>

                     <div>
                        <p class="mt-7 text-lg font-bold">Object attributes.</p>
                        <div class="flex flex-wrap">
                            <a href="#hostname"><p class="mt-1 link px-2">hostname</p></a>
                            <a href="#onmessage"><p class="mt-1 link px-2">onmessage</p></a>
                            <a href="#onopen"><p class="mt-1 link px-2">onopen</p></a>
                            <a href="#port"><p class="mt-1 link px-2">port</p></a>
                            <a href="#send"><p class="mt-1 link px-2">send</p></a>
                            <a href="#start"><p class="mt-1 link px-2">start</p></a>
                        </div>


                        <p id="hostname" class="mt-10 text-xl font-bold  flex align-items-center"><span class="blink">$</span> hostname</span></p>
                         <div class="line mt-4"></div>
                         <p class="mt-3">Returns the hostname specified and its the one being used by the server.</p>
                         <div class="my-6 code">print(app.hostname)</div>

                        <p id="onmessage" class="mt-10 text-xl font-bold  flex align-items-center"><span class="blink">$</span> onmessage<span class="fn">(<span class="args">function action</span>) *</span></p>
                        <div class="line mt-4"></div>
                        <p class="mt-3">Appends action to the functions that should be called when a message is sent.</p>
                        <p class="mt-1">Yeah you can have multi functions added and defining the function remember it should have an <a class="link key">event parameter</a>.</p>
                        <div class="my-6 code">fn msg(event) {
    print(event.data)
}

app.onmessage(msg)</div>
                        <p class="mt-2">The event parameter is passed in by the interpreter and if not specified no data will be inserted in the functions, no error will araise.</p>


                        <p id="onopen" class="mt-10 text-xl font-bold  flex align-items-center"><span class="blink">$</span> onopen<span class="fn">(<span class="args">function action</span>) *</span></p>
                        <div class="line mt-4"></div>
                        <p class="mt-3">Appends action to the functions that should be called when the connection has just opened.</p>
                        <p class="mt-1">You can also have multiple functions and here no parameter is needed for the functions.</p>
                        <div class="my-6 code">app.onopen(?(){
    app.send('successfully connected')
    print('connection established successfully');
}</div>


                        <p id="port" class="mt-10 text-xl font-bold  flex align-items-center"><span class="blink">$</span> port</span></p>
                        <div class="line mt-4"></div>
                        <p class="mt-3">Returns the port number specified and its the one being used by the server.</p>
                        <div class="my-6 code">print(app.port)</div>


                        <p id="send" class="mt-10 text-xl font-bold  flex align-items-center"><span class="blink">$</span> send<span class="fn">(<span class="args">bytes data</span>) *</span></p>
                        <div class="line mt-4"></div>
                        <p class="mt-3">Sends data to the websocket client and in the background will first mask it as required by the websocket protocol.</p>
                        <p class="mt-1">I will recommend sending reasonable amounts of data.</p>
                        <div class="my-6 code">str = importc('string')

msg = str.encode('hello from Luqix')
app.send(msg)</div>

                        <p id="start" class="mt-10 text-xl font-bold  flex align-items-center"><span class="blink">$</span> start<span class="fn">()</span></p>
                        <div class="line mt-4"></div>
                        <p class="mt-3">Starts the server on the current calling thread thread, so if <a class="link key">threads</a> is ready, enjoy multitasking.</p>
                        <div class="my-6 code">app.start();</div>

                        <p class="mt-3">All errors are expected to arise at this point so wrapping in a <a class="link key">try statement</a>.</p>


                    </div>


                    <p class="mt-10 font-bold text-xl">Some sample code for a websocket</p>
                    <div class="my-6 code">let str = importc('string')
    bytes = importc('bytes')
    websocket = importc('websocket')

hostname = 'localhost'
port = 5000

app = websocket.WebsocketServer(hostname, port)

app.onopen(?(){
    app.send(str.encode('Hello from Luqix'))
})


app.onmessage(?(event){
    print(event.data)

    app.send(str.encode(f'Hello {bytes.decode(event.data)}, how are you doing'))
})


print(f'Webserver connecting at ws://{hostname}:{port}...')
app.start();</div>

    <p class="mt-3">No for the webbroswer side</p>
    <p class="mt-1">For the browser code, write a simple <a class="link" href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications">websocket</a> using the port used there as in <span class="key">ws://localhost:5000</span></p>


                    <div role="alert" class="mt-10">
                        <div class="bg-orange-500 text-white font-bold rounded-t px-4 py-2">Notice</div>
                        <div class="border border-t-0 border-orange-400 rounded-b bg-orange-100 px-4 py-3 text-orange-700">
                            <p class="text-orange-700">An update is coming for this function to easily handle errors, as of now the start function can't be used to handle the <a href="https://web-crunch.com/posts/address-already-in-use-resolving-the-bind-error-in-ruby-on-rails#:~:text=The%20%22Address%20already%20in%20use%20bind%20error%22%20occurs%20when%20another,unique%20port%20to%20avoid%20conflicts." class="text-orange-700 font-bold">Address Already In Use Error</a>.</p>
                        </div>
                    </div>



                    <div class="mt-14 mb-5 flex justify-between">
                         <a href="socket.html"><p class="px-7 py-2 text-center text-xl-xxl text-md-md rounded-md hover:text-blue-500"><i class="bi bi-arrow-left"></i>&nbsp;Socket Module</p></a>
                         <a href="url.html"><p class="px-7 py-2 text-center align-items-center text-xl-xxl text-md-md rounded-md hover:text-blue-500">Url module&nbsp;<i class="bi bi-arrow-right hover:text-blue-300"></i></p></a>
                     </div>
                     
                 </div>
             </div>
         </div>
     </div>


    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script type="text/javascript" src="../modules/flare/flare.js"></script>
    <script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>

